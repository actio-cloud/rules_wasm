load("//:rust.bzl", "rust_component")
load("@bazel_skylib//rules:native_binary.bzl", "native_test")

# Example to build a simple component with a custom interface.
rust_component(
    name = "foo",
    srcs = ["foo.rs"],
    wit = "foo.wit",
    world = "the-world",
)

# Example to build a wrapper component to run `foo`,
# using the standard `wasi:cli/run` interface.
rust_component(
    name = "foo-runner",
    srcs = ["runner.rs"],
    wit = "//wasip2:cli",
    world = "command",
)

native_test(
    name = "runner-test",
    size = "small",
    src = "@wasmtime//:wasmtime",
    data = [":foo-runner"],
    args = ["run", "$(location :foo-runner)"],
)